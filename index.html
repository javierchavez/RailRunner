<!DOCTYPE html>
<html>
<head>
    <title>Rail Runner</title>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>


    <style type="text/css">
        #holidayList { display: none; }
    </style>

</head>
<body>


    <div class="container">

        <div class="row">
            <h3>Choose Direction</h3>
        </div>
        <div class="row">
                <ul class="nav nav-pills nav-justified direction">
                    <li class="active"><a href="#">Northbound</a></li>
                    <li><a href="#">Southbound</a></li>
                </ul>
        </div>
        <div class="row">
            <h3>Choose Day</h3>
        </div>
        <div class="row">
                <ul class="nav nav-pills nav-justified day">
                    <li class="active"><a href="#">Weekday</a></li>
                    <li><a href="#">Saturday</a></li>
                    <li><a href="#">Sunday</a></li>
                    <li><a href="#" >Holiday</a></li>
                </ul>
        </div>


        <div class="row">
            <select class="form-control" id="holidayList">
                <option>Martin Luther King Jr. Day</option>
                <option>Presidents' Day</option>
                <option>Memorial Day</option>
                <option>Independence Day</option>
                <option>Labor Day Weekend</option>
                <option>Columbus Day</option>
                <option>Veterans Day</option>
                <option>Thanksgiving Day</option>
                <option>Day After Thanksgiving</option>
                <option>Christmas Eve</option>
                <option>Christmas Day</option>
                <option>Day After Christmas</option>
                <option>New Year's Eve</option>
                <option>New Year's Day</option>
                <option>Day After New Year's</option>
            </select>
        </div>
        <!--User Location selection-->
        <div class="row">
            <div class="row">
                <div class="col-md-4">
                    <h4>Your Location:</h4>
                </div>
                <div class="col-md-4">
                    <select class="form-control" id="from-stations">
                    </select>
                </div>
            </div>
        </div>
        <!--Destination selection-->
        <div class="row">
            <div class="row">
                <div class="col-md-4">
                    <h4>Destination:</h4>
                </div>
                <div class="col-md-4">
                    <select class="form-control" id="to-stations">
                    </select>
                </div>
            </div>
        </div>
        <!--Time selection-->
        <div class="row">
            <div class="row">
                <div class="col-md-4">
                    <h4>Time:</h4>
                </div>
                <div class="col-md-4">
                    <select class="form-control" id="d-time">
                    </select>
                </div>
            </div>
        </div>
    </div>





    <!--<div class="panel-group" id="accordion">-->
        <!--<div class="panel panel-default">-->
            <!--<div class="panel-heading">-->
                <!--<h4 class="panel-title">-->
                    <!--<a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">-->
                        <!--Belen-->
                    <!--</a>-->
                <!--</h4>-->
            <!--</div>-->
            <!--<div id="collapseOne" class="panel-collapse collapse in">-->
                <!--<div class="panel-body">-->
                    <!--<div class="bs-example">-->
                        <!--<table class="table table-hover">-->
                            <!--<thead>-->
                            <!--<tr>-->
                                <!--<th>Ride</th>-->
                                <!--<th>Time</th>-->
                            <!--</tr>-->
                            <!--</thead>-->
                            <!--<tbody>-->
                            <!--<tr>-->
                                <!--<td>#504</td>-->
                                <!--<td>3:55A</td>-->


                            <!--</tr>-->
                            <!--<tr>-->
                                <!--<td>#102 exp</td>-->
                                <!--<td>5:39A</td>-->


                            <!--</tr>-->
                            <!--<tr>-->
                                <!--<td>#506</td>-->
                                <!--<td>6:35A</td>-->

                            <!--</tr>-->
                            <!--</tbody>-->
                        <!--</table>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->
        <!--<div class="panel panel-default">-->
            <!--<div class="panel-heading">-->
                <!--<h4 class="panel-title">-->
                    <!--<a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">-->
                        <!--Belen-->
                    <!--</a>-->
                <!--</h4>-->
            <!--</div>-->
            <!--<div id="collapseTwo" class="panel-collapse collapse in">-->
                <!--<div class="panel-body">-->
                    <!--<div class="bs-example">-->
                        <!--<table class="table table-hover">-->
                            <!--<thead>-->
                            <!--<tr>-->
                                <!--<th>Ride</th>-->
                                <!--<th>Time</th>-->
                            <!--</tr>-->
                            <!--</thead>-->
                            <!--<tbody>-->
                            <!--<tr>-->
                                <!--<td>#504</td>-->
                                <!--<td>3:55A</td>-->


                            <!--</tr>-->
                            <!--<tr>-->
                                <!--<td>#102 exp</td>-->
                                <!--<td>5:39A</td>-->


                            <!--</tr>-->
                            <!--<tr>-->
                                <!--<td>#506</td>-->
                                <!--<td>6:35A</td>-->

                            <!--</tr>-->
                            <!--</tbody>-->
                        <!--</table>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->
    <!--</div>-->



    <script type="text/javascript">
        // Station data from server
        var sData;

        // Helper to find unique stations
        var unique = function(origArr) {
            var newArr = [],
                    origLen = origArr.length,
                    found,
                    x, y;

            for ( x = 0; x < origLen; x++ ) {
                found = undefined;
                for ( y = 0; y < newArr.length; y++ ) {
                    if ( origArr[x] === newArr[y] ) {
                        found = true;
                        break;
                    }
                }
                if ( !found) newArr.push( origArr[x] );
            }
            return newArr;
        };


        //call to get data from server with callback
        var ajax = {
            parseJSONP: function(result){
                sData = result;
                //updateFormData();
                //refresh();

            }
        }

        // get data from server and handle return
        $.ajax(
                {
                    type       : "GET",
                    url        : "http://dev.appliciti.com/nmrx/config/work/json-all-schedules/",
                    dataType   : 'jsonp',
                    success    : function(response) {
                        console.log("Data loaded successfully")
                        ajax.parseJSONP(response);
                    },
                    error      : function() {
                        alert('Not working!');
                        console.log("Something went wrong trying to download data")
                    }

                }
        );

        var direction, day;
        $(document).ready(function () {
            $('ul.nav > li a').click(function (e) {
                // highlight option the user clicked
                $(this).closest('ul.nav').find('.active').removeClass('active');
                $(this).parent().addClass('active');

                // if the user clicked a Day option
                if($(this).text() == "Weekday" || $(this).text() == "Saturday" || $(this).text() == "Sunday" || $(this).text() == "Holiday"){
                    //get the day that the user clicked
                    day = $(this).parent().text();

                    // if user clicked holiday then update DOM
                    if($(this).text() == "Holiday"){
                        $('#holidayList').css({"display":"inline"})
                    } else {
                        $('#holidayList').css({"display":"none"})
                    }
                }
                // the user clicked the direction
                else {
                    direction = $(this).parent().text();
                }

                // console.log("The user choose: DAY: " + day +" DIRECTION: " + direction)


                refresh(); //must be called first
                updateFormData();
            });
        });

        function refresh(){
            if(sData != null){
                tmp = []
                for (var i =0; i < sData.length;i++){
                    //add check for holiday(holidays)
                    if((sData[i]["name"].indexOf(direction) != -1) && (sData[i]["name"].indexOf(day) != -1)){
                        // console.log(sData[i]["name"])
                        for (var x = 0; x < sData[i]["data"].length; x++){
                            tmp.push(sData[i]["data"][x]["station"])
                        }


                    }
                }
            }
        }

        function updateFormData(){
            var test = []
            for (var g =0; g < sData[0]["data"].length; g++){
                tmp.push(sData[0]["data"][g]["station"])
            }
            // get unique stations
            test = unique(tmp)

            //creating drop downs data
            /*This is for the TO field*/
            var stringTo = ""
            for (var s = 0; s < test.length; s++){
                stringTo += '<option>'+ test[s] +'</option>';
            }
            document.getElementById("to-stations").innerHTML = ""
            document.getElementById("to-stations").innerHTML = stringTo

            /*This is for the FROM field*/
            var stringFrom = ""
            for (var s = 0; s < test.length; s++){
                stringFrom += '<option>'+ test[s] +'</option>';
            }
            document.getElementById("from-stations").innerHTML = ""
            document.getElementById("from-stations").innerHTML = stringFrom
        }


    </script>

</body>
</html>